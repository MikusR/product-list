<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <title>Products</title>
</head>
<body>

<div class="container">
    <a href="/add-product">
        <button class="btn btn-primary">ADD</button>
    </a>


    <button onclick="massDelete();" name="massdelete" class="btn btn-primary">MASS DELETE
    </button>

    <div class="row row-cols-1 row-cols-xl-4 g-4">
        {% for product in products %}
            <div class="col">
                <div class="card h-100" style="width: 18rem;">
                    <div class="card-body">
                        <input type="checkbox" class="delete-checkbox" value="{{ product.sku }}">
                        <h5 class="card-title">name: {{ product.name }}</h5>
                        <div>SKU: {{ product.sku }}</div>
                        <div>price: {{ product.price }}</div>
                        <div>type: {{ product.type }}</div>


                        {% for atribute in product.atributes %}
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">{{ atribute.name }}: {{ atribute.value }}</li>
                            </ul>


                        {% endfor %}</div>


                    <br/>
                </div>
            </div>


        {% endfor %}
    </div>
</div>

<script>

    async function postJSON(data) {
        try {
            console.log(data);
            const response = await fetch("/delete", {
                method: "POST", // or 'PUT'
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            });

            // const result = await response.text();
            // document.body.innerHTML = result;
            // console.log(result);
            window.location.replace("/");
        } catch (error) {
            console.error("error", error.message);
        }
    }

    function massDelete() {

        let checked = document.querySelectorAll(".delete-checkbox:checked");
        checked = Array.from(checked).map(checkbox => checkbox.value);

        postJSON(checked);
    }


</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
</body>
</html>